{% extends "base/base.html" %} {% block content %}
<!-- Main content of the second page -->
<main class="pt-20 mx-auto p-4">
  <div class="text-center">
    <h1 class="text-3xl font-semibold">Enter Your Interest</h1>
    <p class="mt-4">
      Search for courses and enhance your skills based on your interests.
    </p>

    <div id="searchSection">
      <input
        id="interestInput"
        type="text"
        class="mt-4 p-2 border border-gray-300 rounded-md"
        placeholder="Enter your interest"
      />
      <button
        onclick="searchVideos()"
        class="mt-4 bg-blue-500 text-white p-2 rounded-md"
      >
        Search
      </button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8">
      <!-- Left side: Video section -->
      <div id="videoList" class="video-container">
        <!-- Video results will be populated here -->
      </div>

      <!-- Right side: Compiler section -->
      <div id="compilerSection" class="bg-gray-900 text-white p-6  shadow-lg">
        <h2 class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4">Code Compiler</h2>
        
        <!-- Compiler Form -->
        <form method="POST" action="" class="mt-4">
          {% csrf_token %}
          
          <!-- Code Input (Code Editor Area) -->
          <div class="mb-4">
            <textarea
              name="code"
              id="codeEditor"
              class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-md focus:outline-none"
              rows="12"
              placeholder="Write your code here..."
            ></textarea>
          </div>
      
          <!-- Language Selector -->
          <div class="mb-4">
            <label for="language" class="block text-sm font-medium">Language</label>
            <select
              name="language"
              id="language"
              class="mt-2 p-2 border border-gray-700 bg-gray-800 text-white rounded-md focus:ring-2 focus:ring-blue-500"
            >
              <option value="python">Python</option>
              <option value="c">C</option>
              <!-- Add more languages if needed -->
            </select>
          </div>
      
          <!-- Compile & Run Button -->
          <button
            type="submit"
            class="mt-4 bg-blue-500 text-white p-3 rounded-md w-full hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            Compile & Run
          </button>
        </form>
      
        <!-- Output Section -->
        {% if output %}
          <div class="mt-6">
            <h3 class="text-xl text-green-400">Output:</h3>
            <pre class="bg-gray-800 text-white p-4 rounded-md shadow-md">{{ output }}</pre>
          </div>
        {% endif %}
      
        <!-- Errors Section -->
        {% if errors %}
          <div class="mt-6">
            <h3 class="text-xl text-red-500">Errors:</h3>
            <pre class="bg-gray-800 text-white p-4 rounded-md shadow-md">{{ errors }}</pre>
          </div>
        {% endif %}
      </div>
      
      <!-- Include Syntax Highlighting Library (Prism.js) -->
      <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.css" rel="stylesheet" />
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
      
      <!-- JavaScript to enhance the text area with syntax highlighting -->
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          const codeEditor = document.getElementById('codeEditor');
          
          // Initialize Prism syntax highlighting for the text area
          codeEditor.addEventListener('input', function () {
            // Wrap the input code area for syntax highlighting
            codeEditor.innerHTML = Prism.highlight(codeEditor.value, Prism.languages.python, 'python');
          });
        });
      </script>
      
          </div>
      =======================================
      <!-- Right side: Compiler section -->
      <div id="compilerSection" class="bg-gray-900 text-white p-6 rounded-lg shadow-lg min-h-[700px]">
        <h2 class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4">Code Compiler</h2>
    
        <form method="POST" action="" class="mt-4">
          {% csrf_token %}
    
          <!-- Code Input (Code Editor Area) -->
          <div class="mb-4">
            <label for="codeEditor" class="block text-sm font-medium text-gray-300">Write your code:</label>
            <textarea
              name="code"
              id="codeEditor"
              class="w-full p-3 bg-gray-800 text-green-300 border border-gray-700 rounded-md font-mono focus:outline-none focus:ring-2 focus:ring-blue-500"
              rows="12"
              placeholder="Type or paste your code here..."
            ></textarea>
          </div>
    
          <!-- Language Selection -->
          <div class="mb-4">
            <label for="language" class="block text-sm font-medium text-gray-300">Select Language:</label>
            <select
              name="language"
              id="language"
              class="w-full p-2 bg-gray-800 text-white border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="python">Python</option>
              <option value="c">C</option>
              <option value="cpp">C++</option>
              <option value="java">Java</option>
              <!-- Add more languages if needed -->
            </select>
          </div>
    
          <!-- Compile & Run Button -->
          <button
            type="submit"
            class="w-full bg-green-600 hover:bg-green-500 text-white font-bold p-3 rounded-lg transition"
          >
            Compile & Run
          </button>
        </form>
    
        <!-- Output Section -->
        {% if output %}
        <div class="mt-6 p-4 bg-gray-800 rounded-lg shadow-inner max-h-40 overflow-auto">
          <h3 class="text-lg font-semibold text-green-400">Output:</h3>
          <pre class="bg-black text-green-300 p-3 rounded-md font-mono overflow-auto">{{ output }}</pre>
        </div>
        {% endif %}
    
        <!-- Error Section -->
        {% if errors %}
        <div class="mt-6 p-4 bg-gray-800 rounded-lg shadow-inner max-h-40 overflow-auto">
          <h3 class="text-lg font-semibold text-red-400">Errors:</h3>
          <pre class="bg-black text-red-400 p-3 rounded-md font-mono overflow-auto">{{ errors }}</pre>
        </div>
        {% endif %}
      </div>
      ====================================
<!-- Note-taking Section -->
<div class="mt-8 p-6 bg-white shadow-lg rounded-lg">
  <h2 class="text-2xl font-bold mb-4 text-gray-800">üìù Take Notes</h2>
  
  <form method="POST" action="{% url 'note-create' %}" class="space-y-4">
    {% csrf_token %}
    
    <!-- Title Input -->
    <div>
      <label for="id_title" class="block text-sm font-medium text-gray-700">Title</label>
      <input
        type="text"
        name="title"
        id="id_title"
        class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm"
        placeholder="Enter note title"
        required
      />
    </div>

    <!-- Content Input (Rich Text Editor) -->
    <div>
      <label for="id_content" class="block text-sm font-medium text-gray-700">Content</label>
      <textarea
        name="content"
        id="id_content"
        class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm min-h-[200px]"
        placeholder="Write your notes here..."
        required
      ></textarea>
    </div>
    
    <!-- Submit Button -->
    <div class="flex justify-end">
      <button
        type="submit"
        class="bg-blue-500 text-white px-5 py-2 rounded-lg hover:bg-blue-600 transition focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-md"
      >
        üíæ Save Note
      </button>
    </div>
  </form>
</div>

<!-- Floating Action Button -->
<button
  onclick="document.getElementById('id_title').focus()"
  class="fixed bottom-10 right-10 bg-blue-500 text-white p-4 rounded-full shadow-lg hover:bg-blue-600 transition focus:outline-none"
>
  ‚ûï
</button>

  </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script>
  const apiKey = "AIzaSyD5DcV6sI-s9NCEKdQjVF2a19lG4696L1U"; // Replace with a valid YouTube API key

  // Function to search videos
  function searchVideos() {
    const query = document.getElementById("interestInput").value;
    if (!query) {
        alert("Please enter a search query.");
        return;
    }

    const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${query}&key=${apiKey}&type=video&maxResults=12`;

    axios.get(url)
        .then((response) => {
            console.log("API Response:", response); // Log API response
            const videos = response.data.items;
            if (videos.length === 0) {
                alert("No videos found. Try a different search.");
            } else {
                // Hide the search section after search
                document.getElementById("searchSection").style.display = "none";

                // Display all videos
                displayAllVideos(videos);
            }
        })
        .catch((error) => {
            console.error("Error fetching videos:", error);
        });
}

// Function to display all videos and allow selection
function displayAllVideos(videos) {
    const videoListContainer = document.getElementById("videoList");
    videoListContainer.innerHTML = ""; // Clear previous results

    videos.forEach((video) => {
        const videoElement = document.createElement("div");
        videoElement.classList.add("bg-white", "p-4", "rounded-lg", "shadow-md", "text-center");

        // Create video iframe
        const videoIframe = document.createElement("iframe");
        videoIframe.src = `https://www.youtube.com/embed/${video.id.videoId}`;
        videoIframe.frameBorder = "0";
        videoIframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
        videoIframe.allowFullscreen = true;
        videoIframe.style.width = "100%";
        videoIframe.style.height = "40vh";

        // Create video title
        const videoTitle = document.createElement("p");
        videoTitle.innerText = video.snippet.title;
        videoTitle.classList.add("mt-2", "text-lg", "font-semibold");

        // Create "Select Video" button
        const selectButton = document.createElement("button");
        selectButton.innerText = "Select This Video";
        selectButton.classList.add("mt-2", "bg-blue-500", "text-white", "p-2", "rounded-md");
        selectButton.onclick = function () {
            displaySelectedVideo(video);
        };

        // Append elements to video container
        videoElement.appendChild(videoIframe);
        videoElement.appendChild(videoTitle);
        videoElement.appendChild(selectButton);

        // Append video container to main list
        videoListContainer.appendChild(videoElement);
    });
}

// Function to display selected video
function displaySelectedVideo(video) {
    const selectedVideoContainer = document.getElementById("videoList");
    selectedVideoContainer.innerHTML = ""; // Clear previous content

    const videoElement = document.createElement("div");
    videoElement.classList.add("bg-white", "p-4", "rounded-lg", "shadow-md", "text-center");

    const videoIframe = document.createElement("iframe");
    videoIframe.src = `https://www.youtube.com/embed/${video.id.videoId}`;
    videoIframe.frameBorder = "0";
    videoIframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
    videoIframe.allowFullscreen = true;
    videoIframe.style.width = "100%";
    videoIframe.style.height = "50vh";

    const videoTitle = document.createElement("p");
    videoTitle.innerText = video.snippet.title;
    videoTitle.classList.add("mt-2", "text-lg", "font-semibold");

    videoElement.appendChild(videoIframe);
    videoElement.appendChild(videoTitle);
    
    selectedVideoContainer.appendChild(videoElement);
}

  // Function to save the top post
  function saveTopPost(video) {
    // Save video data in localStorage for future reference
    localStorage.setItem("topVideo", JSON.stringify(video));
  }

  // Function to display the saved top post
  function displayTopPost(video) {
    const savedVideoSection = document.getElementById("videoList");
    savedVideoSection.innerHTML = ""; // Clear previous content

    const videoElement = document.createElement("div");
    videoElement.classList.add(
      "bg-white",
      "p-4",
      "rounded-lg",
      "shadow-md",
      "text-center"
    );

    // Video iframe with 50% width and 50% height positioning
    const videoIframe = document.createElement("iframe");
    videoIframe.src = `https://www.youtube.com/embed/${video.id.videoId}`;
    videoIframe.frameBorder = "0";
    videoIframe.allow =
      "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
    videoIframe.allowFullscreen = true;

    videoIframe.style.width = "100%"; // 100% width (fill left side)
    videoIframe.style.height = "50vh"; // 50% of the viewport height

    const videoTitle = document.createElement("p");
    videoTitle.innerText = video.snippet.title;

    videoElement.appendChild(videoIframe);
    videoElement.appendChild(videoTitle);

    savedVideoSection.appendChild(videoElement);
  }

  // Load the saved top video from localStorage when the page loads
  window.onload = function () {
    const savedTopVideo = localStorage.getItem("topVideo");
    if (savedTopVideo) {
      const topVideo = JSON.parse(savedTopVideo);
      displayTopPost(topVideo); // Display the saved top post
    }
  };
</script>
{% endblock content %}
